{% extends "core/base.html" %} {% load base_extras %} {% block body %}
{% has_admin loot_group.fleet user as admin %}
<div class="row">
  <div class="col s12 m12">
    <div class="card blue-grey darken-1">
      <div class="card-content white-text">
        <span class="card-title"> {{loot_group.fleet_anom.anom_type}} </span>
        <p>
          <b>Run At:</b> {{loot_group.fleet_anom.time}}<br />
          <b>Location:</b> {{loot_group.fleet_anom.system}}<br />
        </p>
      </div>
      <div class="card-action">
        <a class="waves-effect waves-light btn green lighten-2"
        href="{% url 'fleet_view' loot_group.fleet_anom.fleet.id %}"><i class="material-icons right">info</i>Back to Fleet</a>
      </div>
    </div>
  </div>
</div>
<div class="row">
    <div class="col m12 s12">
        <ul class="collapsible">
            <li>
                <div class="collapsible-header"><i class="material-icons">add</i>Shareable Participation Invite Link</div>
                <div class="collapsible-body">
                    <div class="input-field">
                        <i class="material-icons prefix">share</i>
                        <input type="text" id="shareurl" value="{{request.build_absolute_uri}}/join"> 
                        <label for="shareurl">Shareable Fleet Invite Link</label>
                    </div>
                    <button data-clipboard-target="#shareurl" class="waves-effect waves-light btn" id="share_button">Copy Invite Link</button>
                </div>
            </li>
        </ul>
    </div>
</div>
<div class="row">
  <div class="col s12 m12">
    <h5>Loot</h5>
    <table class="responsive-table striped">
      <thead>
        <th>Item</th>
        <th>Quantity</th>
        <th>Location</th>
        <th>Status</th>
        <th>Actions</th>
      </thead>
      <tbody>
        {% for item in loot_group.inventoryitem_set.all %}
        <tr>
          <td>
                <a href="{% url 'item_view' item.id %}">
                  {{item.item}}
                </a>
          </td>
          <td>{{item.quantity}}</td>
          <td>{{item.location}}</td>
          <td>{{item.status}}</td>
        <td>
        {% has_item_admin item user as item_admin %}
        {% if item_admin %}
        <a 
          href="{% url 'item_edit' item.id %}">Edit</a>
            <form method="post" action="{% url 'item_delete' item.id %}">
                {% csrf_token %}
                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}"/>
                {% endif %}
                <button style="background:none; border-width:0px; color:red; text-decoration:underline;" type="submit">Delete</button>
            </form>
        {% endif %}
        </td>
        </tr>
        {% endfor %}
        {% if admin %}
        <tr>
        <td colspan="5">
        <a class="waves-effect waves-light btn green darken-2"
          href="{% url 'item_add' loot_group.id %}"><i class="material-icons right">add_circle</i>Add Item</a>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  <div class="row">
  <div class="col s12 m12">
    <h5>Participation</h5>
    <table class="responsive-table striped">
      <thead>
        <th>Discord User</th>
        <th>InGame Character</th>
        <th>Number of Shares</th>
        <th>Flat Percent Cut</th>
        <th>Actions</th>
      </thead>
      <tbody>
        {% for loot_shares in loot_shares_by_discord_id.values %}
        {% for share in loot_shares %}
        <tr>
                {% if forloop.first %}
                <td rowspan="{{loot_shares|length}}"><img src="{{ share.character.discord_avatar_url }}?size=32" alt=""
                                                      class="circle">
                    {{share.character.discord_username}}
                </td>
                {% endif %}
          <td>{{share.character}}</td>
          <td>{{share.share_quantity}}</td>
          <td>{{share.flat_percent_cut}}%</td>
          <td>
          {% if admin %}
        <a 
          href="{% url 'loot_share_edit' share.id %}">Edit</a>
            <form method="post" action="{% url 'loot_share_delete' share.id %}">
                {% csrf_token %}
                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}"/>
                {% endif %}
                <button style="background:none; border-width:0px; color:red; text-decoration:underline;" type="submit">Delete</button>
            </form>

          {% endif %}
          
          </td>
        </tr>
        {% endfor %}
        {% endfor %}
        <tr>
        <td colspan="5">
        {% has_share loot_group user as has_share_already %}
        {% loot_group_still_can_join_alts loot_group user as user_can_still_join_alts %}
        {% if not has_share_already %}
        <a class="waves-effect waves-light btn green darken-2"
          href="{% url 'loot_share_join' loot_group.id %}"><i class="material-icons right">add_circle</i>Join As Participant</a>
        {% elif user_can_still_join_alts %}
        <a class="waves-effect waves-light btn purple darken-2"
          href="{% url 'loot_share_join' loot_group.id %}"><i class="material-icons right">add_circle</i>Join Another Alt As Participant</a>
        {% endif %}
        {% if admin %}
        <a class="waves-effect waves-light btn green darken-2"
          href="{% url 'loot_share_add' loot_group.id %}"><i class="material-icons right">add_circle</i>Add Participant</a>
            <form method="post" action="{% url 'loot_share_add_fleet_members' loot_group.id %}">
                {% csrf_token %}
                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}"/>
                {% endif %}
                <button class="waves-effect waves-light btn" type="submit">Give All Fleet Members 1 Share</button>
            </form>
        {% endif %}
            </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

{% endblock %}


{% block extrafooter %}

<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script>




<script>
var clipboard = new ClipboardJS('.btn');

  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.collapsible');
    var instances = M.Collapsible.init(elems);
  });

</script>





{% endblock %}