{% extends "core/base.html" %} {% load base_extras %} {% block body %}
{% has_admin loot_group.fleet user as admin %}
<div class="row">
  <div class="col s12 m12">
    <div class="card blue-grey darken-1">
      <div class="card-content white-text">
        <span class="card-title"> {{loot_group.fleet_anom.anom_type}} </span>
        <p>
          <b>Run At:</b> {{loot_group.fleet_anom.time}}<br />
          <b>Location:</b> {{loot_group.fleet_anom.system}}<br />
        </p>
      </div>
      <div class="card-action">
        <a class="waves-effect waves-light btn green lighten-2"
          href="{% url 'fleet_view' loot_group.fleet_anom.fleet.id %}"><i class="material-icons right">info</i>Back to Fleet</a>
      </div>
    </div>
  </div>
  <div class="col s12 m6">
    <h5>Loot</h5>
    <table>
      <thead>
        <th>Item</th>
        <th>Quantity</th>
        <th>Location</th>
        <th>Status</th>
        <th>Actions</th>
      </thead>
      <tbody>
        {% for item in loot_group.inventoryitem_set.all %}
        <tr>
          <td>{{item.item}}</td>
          <td>{{item.quantity}}</td>
          <td>{{item.location}}</td>
          <td>{{item.status}}</td>
        <td>
        {% has_item_admin item user as item_admin %}
        {% if item_admin %}
        <a 
          href="{% url 'item_edit' item.id %}">Edit</a>
            <form method="post" action="{% url 'item_delete' item.id %}">
                {% csrf_token %}
                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}"/>
                {% endif %}
                <button style="background:none; border-width:0px; color:red; text-decoration:underline;" type="submit">Delete</button>
            </form>
        {% endif %}
        </td>
        </tr>
        {% endfor %}
        {% if admin %}
        <tr>
        <td colspan="4">
        <a class="waves-effect waves-light btn green darken-2"
          href="{% url 'item_add' loot_group.id %}"><i class="material-icons right">add_circle</i>Add Item</a>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  <div class="col s12 m6">
    <h5>Participation</h5>
    <table>
      <thead>
        <th>Discord User</th>
        <th>InGame Character</th>
        <th>Number of Shares</th>
        <th>Flat Percent Cut</th>
        <th>Actions</th>
      </thead>
      <tbody>
        {% for loot_shares in loot_shares_by_discord_id.values %}
        {% for share in loot_shares %}
        <tr>
                {% if forloop.first %}
                <td rowspan="{{loot_shares|length}}"><img src="{{ share.character.discord_avatar_url }}?size=32" alt=""
                                                      class="circle">
                    {{share.character.discord_username}}
                </td>
                {% endif %}
          <td>{{share.character}}</td>
          <td>{{share.share_quantity}}</td>
          <td>{{share.flat_percent_cut}}%</td>
          <td>
          {% if admin %}
        <a 
          href="{% url 'loot_share_edit' share.id %}">Edit</a>
            <form method="post" action="{% url 'loot_share_delete' share.id %}">
                {% csrf_token %}
                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}"/>
                {% endif %}
                <button style="background:none; border-width:0px; color:red; text-decoration:underline;" type="submit">Delete</button>
            </form>

          {% endif %}
          
          </td>
        </tr>
        {% endfor %}
        {% endfor %}
        {% if admin %}
        <tr>
        <td colspan="4">
        <a class="waves-effect waves-light btn green darken-2"
          href="{% url 'loot_share_add' loot_group.id %}"><i class="material-icons right">add_circle</i>Add Participant</a>
            <form method="post" action="{% url 'loot_share_add_fleet_members' loot_group.id %}">
                {% csrf_token %}
                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}"/>
                {% endif %}
                <button class="waves-effect waves-light btn" type="submit">Give All Fleet Members 1 Share</button>
            </form>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  <div class="col s6 m6"></div>
</div>

{% endblock %}
